#
# Ce fichier contient les requetes pr\u00e9programm\u00e9es.
# Par souci d'homog\u00e9n\u00e9\u00eft\u00e9, le format a \u00e9t\u00e9 choisi identique au format de
# sauvegarde des requ\u00eates locales (fichier properties).
#
# @author Samuel Andr\u00e9s (Geomatys)
#
#
newPonctualDisordersByType.title=Nouveaux d\u00e9sordres ponctuels par type
newPonctualDisordersByType.query=select d."id", d."designation", d."date_debut", d."date_fin", d."prDebut", d."prFin", t."libelle" as "type" from "Desordre" d, "RefTypeDesordre" t where d."typeDesordreId" like t."id" and (d."positionDebut" like d."positionFin" or d."prDebut" like d."prFin" or (d."positionDebut" is not null and d."positionFin" is null)) and (d."date_fin" is null) order by d."date_debut" desc, t."libelle" asc
newPonctualDisordersByType.description=On consid\u00e8re la "nouveaut\u00e9" en classant les d\u00e9sordres par date de d\u00e9but d\u00e9croissante.\nOn consid\u00e8re la "ponctualit\u00e9" par l'identit\u00e9 des positions de d\u00e9but et de fin ou bien par l'identit\u00e9 des PRs de d\u00e9but et de fin, ou bien par la nullit\u00e9 de la position de fin si la position de d\u00e9but n'est pas nulle.
#
newLinearDisordersByType.title=Nouveaux d\u00e9sordres lin\u00e9aires par type
newLinearDisordersByType.query=select d."id", d."designation", d."date_debut", d."date_fin", d."prDebut", d."prFin", t."libelle" as "type" from "Desordre" d, "RefTypeDesordre" t where d."typeDesordreId" like t."id" and (d."positionDebut" not like d."positionFin" or d."prDebut" not like d."prFin") and (d."date_fin" is null) order by d."date_debut" desc, t."libelle" asc
newLinearDisordersByType.description=On consid\u00e8re la "nouveaut\u00e9" en classant les d\u00e9sordres par date de d\u00e9but d\u00e9croissante\nOn consid\u00e8re la "lin\u00e9arit\u00e9" par la diff\u00e9rence des positions de d\u00e9but et de fin ou bien par la diff\u00e9rence des PRs de d\u00e9but et de fin.
#
processedDisordersByType.title=D\u00e9sordres trait\u00e9s sur une p\u00e9riode par type
processedDisordersByType.query=select d."id", d."designation", d."date_debut", d."date_fin", d."prDebut", d."prFin", t."libelle" as "type" from "Desordre" d, "RefTypeDesordre" t where d."typeDesordreId" like t."id" and d."date_fin">'2011-01-01' and d."date_fin"<'2012-01-01'
processedDisordersByType.description=La p\u00e9riode de la requ\u00eate est l'ann\u00e9e 2011.
#
observerdDisordersBySection.title=D\u00e9sordres observ\u00e9s par tron\u00e7on
observerdDisordersBySection.query=select d."id", d."designation", td."libelle" from "Desordre" d, "TronconDigue" td where d."linearId" like td."id" order by td."id"
observerdDisordersBySection.description=
#
countDisordersByBank.title=D\u00e9nombrement des d\u00e9sordres par rive
countDisordersByBank.query=select count(*), r."libelle" from "Desordre" d, "TronconDigue" t, "RefRive" r where d."linearId" like t."id" and t."typeRiveId" like r."id" group by r."id" order by r."libelle"
countDisordersByBank.description=
#
disordersByBank.title=D\u00e9sordres par rive
disordersByBank.query=select d."id", d."designation", r."libelle" from "Desordre" d, "TronconDigue" t, "RefRive" r where d."linearId" like t."id" and t."typeRiveId" like r."id" order by r."libelle"
disordersByBank.description=
#
costOfMaintenanceWorkByType.title=Montant des travaux d'entretien par type de travail
costOfMaintenanceWorkByType.query=select sum("coutGlobal") as cout, tp."libelle"  from "Prestation" p, "RefPrestation" tp  where p."typePrestationId" like tp."id" group by "typePrestationId" order by cout desc
costOfMaintenanceWorkByType.description=
#
costOfMaintenanceWorkByTypeBySection.title=Montant des travaux d'entretien par type de travail par tron\u00e7on
costOfMaintenanceWorkByTypeBySection.query=select sum("coutGlobal") as cout, tp."libelle" as prestation, td."libelle" as troncon  from "Prestation" p, "RefPrestation" tp, "TronconDigue" td  where p."typePrestationId" like tp."id" and td."id" like p."linearId" group by "typePrestationId", td."id" order by cout desc
costOfMaintenanceWorkByTypeBySection.description=
#
objectLengthByType.title=Longueur cumul\u00e9e des objets de structure par type
objectLengthByType.query=select "concrete_table_name", sum(abs("prFin"-"prDebut")) as "lin\u00e9aire (km)" from "ObjetStructure" group by "concrete_table_name"
objectLengthByType.description=
#
objectLengthBySectionByType.title=Longueur cumul\u00e9e des objets de structure par type et par tron\u00e7on
objectLengthBySectionByType.query=select s."concrete_table_name" as "type d'\u00e9l\u00e9ment", t."libelle", t."designation", sum(abs(s."prFin"-s."prDebut")) as "lin\u00e9aire (km)" from "ObjetStructure" s, "TronconDigue" t where t."id"=s."linearId" group by s."concrete_table_name", s."linearId" order by "concrete_table_name", s."linearId"
objectLengthBySectionByType.description=
#
rhfAndProperty.title=Conduites ferm\u00e9es avec informations de propri\u00e9t\u00e9
rhfAndProperty.query=select RHF.*, TD."libelle" as tid, PO."date_debut" as "Debut de propri\u00e9t\u00e9", PO."date_fin" as "Fin de propri\u00e9t\u00e9", ORG."nom" as "Organisme", ORG."telephone" as "T\u00e9l\u00e9phone organisme", ORG."email" as "E-mail organisme", CON."nom" as "Contact", CON."telephone" as "T\u00e9l\u00e9phone particulier", CON."email" as "E-mail particulier" FROM ("ReseauHydrauliqueFerme" RHF left join "ProprieteObjet" PO ON RHF."id" \= PO."parent_id" left join "TronconDigue" TD ON TD."id" \= RHF."linearId" left join "Organisme" ORG ON ORG."id" \= PO."organismeId" left join "Contact" CON on CON."id" \= PO."contactId")
rhfAndProperty.description=S\u00e9lection des conduites ferm\u00e9es avec les noms et coordonn\u00e9es des propri\u00e9taires (organismes ou personnes physiques) et le nom du tron\u00e7on
#
currentDisordersAndLastObservation.title=Desordres courants avec derni\u00e8re observation
currentDisordersAndLastObservation.query=SELECT \n-- infos sur le desordre\nd."id", d."designation", \nd."date_debut", \nd."prDebut",\nd."prFin",\ncat."abrege" as code_cat,\ncat."libelle" as nom_cat,\ntype_d."abrege" code_type,\ntype_d."libelle" as nom_type, \n-- infos sur le tron\u00e7on\ntr."designation" as code_tron\u00e7on,\ntr."libelle" as nom_tron\u00e7on,\n-- infos sur la derni\u00e8re observation\no."designation" as code_observation,\no."date" as date_observation,\nu."abrege" as code_urgence,\nu."libelle" as titre_urgence\nFROM\n(SELECT "id", "designation", "date_debut", "prDebut", "prFin", "categorieDesordreId", "typeDesordreId", "linearId" FROM "Desordre" WHERE "date_fin" IS NULL) d \n    -- infos sur les cat\u00e9gories des d\u00e9sordres\n    LEFT JOIN "RefCategorieDesordre" cat ON cat."id" \= d."categorieDesordreId" \n    -- infos sur le type des d\u00e9sordres\n    LEFT JOIN "RefTypeDesordre" type_d ON type_d."id" \= d."typeDesordreId"\n    -- Tron\u00e7ons affect\u00e9s\n    LEFT JOIN "TronconDigue" tr ON tr."id" \= d."linearId"\n    LEFT JOIN \n        -- On r\u00e9cup\u00e8re les observations pour chaque d\u00e9sordre choisi.\n        (SELECT "designation", "date", "parent_id", "urgenceId" FROM "Observation"  \n            INNER JOIN\n                -- Observations \u00e0 la date la plus r\u00e9cente pour chaque d\u00e9sordre\n                (SELECT "parent_id" as tmp_pid, MAX("date") as max_date from "Observation" GROUP BY "parent_id") o0 \n            ON "parent_id" \= o0.tmp_pid and "date" \= o0.max_date\n        ) o ON o."parent_id" \= d."id"\n    -- urgence of the returned observations\n    LEFT JOIN "RefUrgence" u ON u."id" \= o."urgenceId"\n    -- tri par date d'observation\n    ORDER BY date_observation DESC;
currentDisordersAndLastObservation.description=Tous les d\u00e9sordres non trait\u00e9s. Informations compl\u00e9mentaires \: \nTron\u00e7on associ\u00e9 et PR sur le tron\u00e7on,\nType du d\u00e9sordre,\nObservations \u00e0 la date la plus r\u00e9cente, avec degr\u00e9 d'urgence.\n\nTri\u00e9 par date d'observation (de la plus r\u00e9cente \u00e0 la plus ancienne).
#
chargeAndHeightForFlood.title=Charge et hauteur de revanche hydraulique pour chaque crue
chargeAndHeightForFlood.query=SELECT\ntr."id", tr."designation" as CODE_TRONCON,\ntr."libelle" as NOM_TRONCON,\n"prDebut" as PR_DEBUT,\n"prFin" as PR_FIN,\nNOM_PROFIL,\neh."designation" as CODE_CRUE,\neh."libelle" as NOM_CRUE,\nCOTE_CRETE,\nCOTE_PIED_TERRE,\nCOTE_EAU,\nCOTE_CRETE - COTE_PIED_TERRE as hauteur_digue_terre,\nCOTE_EAU - COTE_PIED_TERRE as charge,\nCOTE_CRETE - COTE_EAU as revanche\nFROM\n-- Tous les param\u00e8tres hydrauliques (avec les infos sur le profil en travers cible) associ\u00e9s \u00e0 une crue\n(select pt."id" as ptid, pt."libelle" as NOM_PROFIL, ph."coteEau" as COTE_EAU, ph."evenementHydrauliqueId" as crue_id from "ProfilTravers" pt inner join "ParametreHydrauliqueProfilTravers" ph on ph."parent_id" \= pt."id" and ph."evenementHydrauliqueId" is not null and ph."coteEau" > 0)\nINNER JOIN "EvenementHydraulique" eh ON eh."id" \= crue_id\n-- On prends les moyennes associ\u00e9es\nINNER JOIN \n    (\n        -- La moyenne des lev\u00e9s pour chaque position de profil\n        select posId, "linearId", "prDebut", "prFin", "sirsdocument", AVG(lppt."cotePiedDigueTerre") as COTE_PIED_TERRE, AVG(lppt."coteCrete") as COTE_CRETE from "LevePositionProfilTravers" lppt inner join \n            (select * from "LevePositionProfilTraversPositionProfilTravers" inner join (select "id" as posId, "linearId", "prDebut", "prFin", "sirsdocument" from "PositionProfilTravers") on "positionProfilTraversId" \= posId) lpptppt \n            ON lppt."id" \= lpptppt."levePositionProfilTraversId"\n        GROUP BY posId, "linearId", "prDebut", "prFin", "sirsdocument"\n    ) ml ON ml."sirsdocument" \= ptid\n-- On trouve les infos sur les tron\u00e7ons concern\u00e9s\nINNER JOIN "TronconDigue" tr ON tr."id" \= ml."linearId"\n-- Tri\u00e9 par tron\u00e7on, puis de l'amont vers l'aval.\nORDER BY tr."id", PR_DEBUT;
chargeAndHeightForFlood.description=Sur chaque tron\u00e7on, on retrouve les profils en travers associ\u00e9s \u00e0 un \u00e9venement hydraulique.\nOn fait la moyenne des cotes de lev\u00e9 pour chaque profil, et on calcule la charge et la hauteur de revanche pour chaque \u00e9venement hydraulique li\u00e9.
